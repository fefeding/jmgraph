class jmList extends Array{constructor(...t){let e=[];if(t&&t.length&&Array.isArray(t[0])){for(let i=0;i<t[0].length;i++)e.push(t[0][i]);super(...e)}else super();this.option={},this.type="jmList"}add(t){if(t&&Array.isArray(t)){for(let e=0;e<t.length;e++)this.includes(t[e])||this.push(t[e]);return t}return"object"==typeof t&&this.includes(t)?t:(this.push(t),t)}remove(t){for(let e=this.length-1;e>=0;e--)this[e]==t&&this.removeAt(e)}removeAt(t){if(this.length>t){let e=this[t];this.splice(t,1),this.option.removeHandler&&this.option.removeHandler.call(this,e,t)}}contain(t){return this.includes(t)}get(t){return"function"==typeof t?this.find(t):this[t]}each(t,e){if(t&&"function"==typeof t)if(e)for(let e=this.length-1;e>=0;e--){if(!1===t.call(this,e,this[e]))break}else{let e=this.length;for(let i=0;i<e;i++){if(!1===t.call(this,i,this[i]))break}}}count(t){if(t&&"function"==typeof t){let e=0,i=this.length;for(let s=0;s<i;s++)t(this[s])&&e++;return e}return this.length}clear(){this.splice(0,this.length)}}export{jmList};class jmUtils{static clone(t,e=!1){if(t&&"object"==typeof t){if(this.isType(t,jmList))return new jmList(t);if(Array.isArray(t)){if(e){let i=[];for(let s=0;s<t.length;s++)i.push(this.clone(t[s],e));return i}return t.slice(0)}let i={};i.constructor=t.constructor;for(let s in t)i[s]=this.clone(t[s],e);return i}return t}static bindEvent(t,e,i,s){if(!e||!e.indexOf||-1==e.indexOf(" "))return t.attachEvent?t.attachEvent("on"+e,i,s):!!t.addEventListener&&(t.addEventListener(e,i,s),!0);{let n=e.split(" ");for(let e=0;e<n.length;e++)this.bindEvent(t,n[e],i,s)}}static removeEvent(t,e,i){return t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent?(t.detachEvent("on"+e,i),!0):void(t["on"+e]=null)}static getElementPosition(t){let e={top:0,left:0};if(!t)return e;if(t.offsetParent)for(;t.offsetParent;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;else t.x?e.left+=t.x:t.x&&(e.top+=t.y);return e}static getEventPosition(t,e){let i=!1,s=(t=t||event).changedTouches||t.targetTouches||t.touches,n=t.target||t.srcElement;s&&((t=s[0]).target||(t.target=n),i=!0);let o=t.pageX||t.x;void 0===o&&(o=t.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft));let r=t.pageY||t.y;void 0===r&&(r=t.clientY+(document.documentElement.scrollTop||document.body.scrollTop));let h=t.offsetX,a=t.offsetY;if(void 0===h&&void 0===a){let t=this.getElementPosition(n);h=o-t.left,a=r-t.top}return e&&(e.x&&(h/=e.x),e.y&&(a/=e.y)),{pageX:o,pageY:r,clientX:t.clientX,clientY:t.clientY,offsetX:h,offsetY:a,layerX:t.layerX,layerY:t.layerY,screenX:t.screenX,screenY:t.screenY,x:h,y:a,isTouch:i}}static isType(t,e){return!(!t||"object"!=typeof t)&&t.constructor===e}static pointInPolygon(t,e,i){i=i||1,i/=2;let s,n,o=e.length,r=!1,h=!0;if(!e||0==o)return 0;if(1==o)return Math.abs(e[0].x-t.x)<=i&&Math.abs(e[0].y-t.y)<=i;if(2==o){if(Math.min(e[0].x,e[1].x)-t.x>i||t.x-Math.max(e[0].x,e[1].x)>i)return 0;if(Math.min(e[0].y,e[1].y)-t.y>i||t.y-Math.max(e[0].y,e[1].y)>i)return 0;if(e[0].x==e[1].x)return Math.abs(e[0].x-t.x)<=i&&(t.y-e[0].y)*(t.y-e[1].y)<=0?1:0;if(e[0].y==e[1].y)return Math.abs(e[0].y-t.y)<=i&&(t.x-e[0].x)*(t.x-e[1].x)<=0?1:0;if(Math.abs(e[0].x-t.x)<i&&Math.abs(e[0].y-t.y)<i)return 1;if(Math.abs(e[1].x-t.x)<i&&Math.abs(e[1].y-t.y)<i)return 1;if(t.y!=e[0].y&&t.y!=e[1].y){let s=(e[1].x-e[0].x)/(e[1].y-e[0].y)*(t.y-e[0].y),n=(t.y-e[0].y)/Math.sqrt(s*s+(t.y-e[0].y)*(t.y-e[0].y))*(t.x-e[0].x-s);return Math.abs(n)<=i?1:0}return 0}for(s=0;s<o;++s)if(e[s].x==t.x&&e[s].y==t.y)return 1;for(;h;)for(h=!1,r=!1,s=0,n=o-1;s<o;n=s++)if(e[s].y<t.y&&t.y<e[n].y||e[n].y<t.y&&t.y<e[s].y){if(t.x<=e[s].x||t.x<=e[n].x){var a=(t.y-e[s].y)*(e[n].x-e[s].x)/(e[n].y-e[s].y)+e[s].x;if(t.x<a)r=!r;else if(t.x==a)return 1}}else if(t.y==e[s].y){if(t.x<e[s].x){e[s].y>e[n].y?--t.y:++t.y,h=!0;break}}else if(e[s].y==e[n].y&&t.y==e[s].y&&(e[s].x<t.x&&t.x<e[n].x||e[n].x<t.x&&t.x<e[s].x)){r=!0;break}return r?2:0}static judge(t,e,i){i=i||1;for(var s=t.x,n=t.y,o=0,r=0,h=0,a=0;a<e.length-1;a++){var l=e[a],c=e[a+1];if(l.x!==c.x){var d=(c.y-l.y)/(c.x-l.x),p=(n-l.y)/d+l.x;s>p||(c.x>l.x&&p>=l.x&&p<=c.x&&(o++,d>=0?r++:h++),c.x<l.x&&p>=c.x&&p<=l.x&&(o++,d>=0?h++:r++))}else{if(s>l.x)continue;c.y>l.y&&n>=l.y&&n<=c.y&&(r++,o++),c.y<l.y&&n>=c.y&&n<=l.y&&(h++,o++)}}return 1===i?r-h!=0:o%2==1}static checkOutSide(t,e,i){let s={left:0,right:0,top:0,bottom:0};return i.x<0?s.left=e.left+i.x-t.left:i.x>0&&(s.right=e.right+i.x-t.right),i.y<0?s.top=e.top+i.y-t.top:i.y>0&&(s.bottom=e.bottom+i.y-t.bottom),s}static rotatePoints(t,e,i){if(!i||!t)return t;let s=Math.cos(i),n=Math.sin(i);if(t.length)for(let i=0;i<t.length;i++){if(!t[i])continue;let o=t[i].x-e.x,r=t[i].y-e.y;t[i].x=o*s-r*n+e.x,t[i].y=o*n+r*s+e.y}else{let i=t.x-e.x,o=t.y-e.y;t.x=i*s-o*n+e.x,t.y=i*n+o*s+e.y}return t}static trimStart(t,e){if(e=e||" ",t&&t.length>0){let i=t[0];if(i===e||e.indexOf(i)>=0)return t=t.substring(1),this.trimStart(t,e)}return t}static trimEnd(t,e){if(e=e||" ",t&&t.length>0){let i=t[t.length-1];if(i===e||e.indexOf(i)>=0)return t=t.substring(0,t.length-1),this.trimStart(t,e)}return t}static trim(t,e){return this.trimEnd(this.trimStart(t,e),e)}static checkPercent(t){if("string"==typeof t&&"%"==(t=this.trim(t))[t.length-1])return t}static percentToNumber(t){if("string"==typeof t){let e=this.checkPercent(t);e&&(t=this.trim(e,"% "),t/=100)}return t}static hexToNumber(t){if("string"!=typeof t)return t;let e=0,i=(t=t.toLowerCase()).length;for(let s=0;s<i;s++){let n="0123456789abcdef".indexOf(t[s]);if(0!=n){for(let t=1;t<i-s;t++)n*=16;e+=n}}return e}static numberToHex(t){let e="";for(;t>0;){e="0123456789abcdef"[t%16]+e,t=Math.floor(t/16)}return e}static toColor(t,e,i,s){return"string"==typeof t&&t&&"#"==(t=this.trim(t))[0]&&(t.length>=8?(s=t.substr(1,2),e=t.substr(5,2),i=t.substr(7,2),t=t.substr(3,2),s=(this.hexToNumber(s)/255).toFixed(4),t=this.hexToNumber(t||0),e=this.hexToNumber(e||0),i=this.hexToNumber(i||0)):5===t.length&&(s=t.substr(1,1),e=t.substr(3,1),i=t.substr(4,1),t=t.substr(2,1),t=this.hexToNumber(t||0),e=this.hexToNumber(e||0),i=this.hexToNumber(i||0),s=(this.hexToNumber(s)/255).toFixed(4))),void 0!==t&&void 0!==e&&void 0!==i?void 0!==s?"rgba("+t+","+e+","+i+","+s+")":"rgb("+t+","+e+","+i+")":t}}export{jmUtils};class jmObject{constructor(t){t&&"jmGraph"==t.type&&(this.graph=t)}is(t){return"string"==typeof t?this.type==t:this instanceof t}animate(...t){if(this.is("jmGraph")){if(t.length>1){this.animateHandles||(this.animateHandles=new jmList);var e=[];if(t.length>2)for(var i=2;i<t.length;i++)e.push(t[i]);this.animateHandles.add({millisec:t[1]||20,handle:t[0],params:e})}if(this.animateHandles&&this.animateHandles.count()>0){var s=this;this.dispatcher=setTimeout(function(t){t=t||s;var e=[],i=(new Date).getTime();for(var n in t.animateHandles.each(function(s,n){try{if(n&&n.handle&&(!n.times||i-n.times>=n.millisec))!1===n.handle.apply(t,n.params)&&e.push(n),n.times=i}catch(t){window.console&&window.console.info&&window.console.info(t.toString()),n&&e.push(n)}}),e)t.animateHandles.remove(e[n]);t.animate()},10,this)}}else{var n=this.graph;n&&n.animate(...t)}}}export{jmObject};const PROPERTY_KEY=Symbol("properties");class jmProperty extends jmObject{constructor(){super(),this[PROPERTY_KEY]={}}__pro(...t){if(t){let e=this[PROPERTY_KEY],i=t[0];if(t.length>1){let s=t[1],n={oldValue:e[i],newValue:s};return e[i]=t[1],this.emit&&this.emit("propertyChange",i,n),t[1]}if(1==t.length)return e[i]}}get needUpdate(){return this.__pro("needUpdate")}set needUpdate(t){this.__pro("needUpdate",t),t&&!this.is("jmGraph")&&this.graph&&(this.graph.needUpdate=!0)}get graph(){let t=this.__pro("graph");return t=t||this.__pro("graph",this.findParent("jmGraph"))}set graph(t){return this.__pro("graph",t)}}export{jmProperty};class jmEvents{constructor(t,e){this.container=t,this.target=e||t,this.mouseHandler=new jmMouseEvent(this,t,e),this.keyHandler=new jmKeyEvent(this,t,e)}touchStart(t){if(t=t||window.event,this.container.raiseEvent("touchstart",t),(t.target||t.srcElement)==this.target)return!1}touchMove(t){if(t=t||window.event,this.container.raiseEvent("touchmove",t),(t.target||t.srcElement)==this.target)return!1}touchEnd(t){if(t=t||window.event,this.container.raiseEvent("touchend",t),(t.target||t.srcElement)==this.target)return!1}touchCancel(t){if(t=t||window.event,this.container.raiseEvent("touchcancel",t),(t.target||t.srcElement)==target)return!1}}class jmMouseEvent{constructor(t,e,i){this.instance=t,this.container=e,this.target=i||e,this.init(t,e,i)}init(t,e,i){let s=this.target,n=void 0!==typeof document?document:null;jmUtils.bindEvent(this.target,"mousedown",function(t){t=t||window.event;e.raiseEvent("mousedown",t)}),n&&jmUtils.bindEvent(n,"mousemove",function(t){if(((t=t||window.event).target||t.srcElement)==s){e.raiseEvent("mousemove",t);return t.preventDefault&&t.preventDefault(),!1}}),jmUtils.bindEvent(this.target,"mouseover",function(t){t=t||window.event,e.raiseEvent("mouseover",t)}),jmUtils.bindEvent(this.target,"mouseleave",function(t){t=t||window.event,e.raiseEvent("mouseleave",t)}),jmUtils.bindEvent(this.target,"mouseout",function(t){t=t||window.event,e.raiseEvent("mouseout",t)}),n&&jmUtils.bindEvent(n,"mouseup",function(t){if(t=t||window.event,!1===e.raiseEvent("mouseup",t))return t.preventDefault&&t.preventDefault(),!1}),jmUtils.bindEvent(this.target,"dblclick",function(t){t=t||window.event,e.raiseEvent("dblclick",t)}),jmUtils.bindEvent(this.target,"click",function(t){t=t||window.event,e.raiseEvent("click",t)}),n&&jmUtils.bindEvent(n,"resize",function(t){return t=t||window.event,e.raiseEvent("resize",t)}),n&&jmUtils.bindEvent(n,"touchstart",function(e){return t.touchStart(e)},{passive:!1}),n&&jmUtils.bindEvent(n,"touchmove",function(e){return t.touchMove(e)},{passive:!1}),n&&jmUtils.bindEvent(n,"touchend",function(e){return t.touchEnd(e)},{passive:!1}),n&&jmUtils.bindEvent(n,"touchcancel",function(e){return t.touchCancel(e)},{passive:!1})}}class jmKeyEvent{constructor(t,e,i){this.instance=t,this.container=e,this.target=i||e,this.init(e,i)}init(t,e){let i=void 0!==typeof document?document:null,s=t=>{let e=t.srcElement||t.target;return!e||"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName&&"ANCHOR"!=e.tagName&&"FORM"!=e.tagName&&"FILE"!=e.tagName&&"IMG"!=e.tagName&&"HIDDEN"!=e.tagName&&"RADIO"!=e.tagName&&"TEXT"!=e.tagName};i&&jmUtils.bindEvent(i,"keypress",function(e){if(e=e||window.event,!s(e))return;let i=t.raiseEvent("keypress",e);return!1===i&&e.preventDefault&&e.preventDefault(),i}),i&&jmUtils.bindEvent(i,"keydown",function(e){if(e=e||window.event,!s(e))return;let i=t.raiseEvent("keydown",e);return!1===i&&e.preventDefault&&e.preventDefault(),i}),i&&jmUtils.bindEvent(i,"keyup",function(e){if(e=e||window.event,!s(e))return;let i=t.raiseEvent("keyup",e);return!1===i&&e.preventDefault&&e.preventDefault(),i})}}export{jmEvents};class jmGradient{constructor(t){if(this.stops=new jmList,t&&"object"==typeof t)for(let e in t)this[e]=t[e];else"string"==typeof t&&this.fromString(t)}addStop(t,e){this.stops.add({offset:t,color:e})}toGradient(t){let e,i=t.context||t,s=t.absoluteBounds?t.absoluteBounds:t.getAbsoluteBounds(),n=this.x1||0,o=this.y1||0,r=this.x2,h=this.y2,a=t.getLocation(),l=0;a.radius&&(l=2*a.radius),l||(l=Math.min(a.width,a.height)),jmUtils.checkPercent(n)&&(n=jmUtils.percentToNumber(n)*(a.width||l)),jmUtils.checkPercent(r)&&(r=jmUtils.percentToNumber(r)*(a.width||l)),jmUtils.checkPercent(o)&&(o=jmUtils.percentToNumber(o)*(a.height||l)),jmUtils.checkPercent(h)&&(h=jmUtils.percentToNumber(h)*(a.height||l));let c=Number(n)+s.left,d=Number(o)+s.top,p=Number(r)+s.left,u=Number(h)+s.top;if("linear"===this.type)e=i.createLinearGradient(c,d,p,u);else if("radial"===this.type){let t=this.r1||0,s=this.r2;jmUtils.checkPercent(t)&&(t=jmUtils.percentToNumber(t),t*=l),jmUtils.checkPercent(s)&&(s=jmUtils.percentToNumber(s),s*=l),e=i.createCircularGradient?i.createCircularGradient(c,d,s):i.createRadialGradient(c,d,t,p,u,s)}return this.stops.each(function(t,i){let s=jmUtils.toColor(i.color);e.addColorStop(i.offset,s)}),e}fromString(t){if(!t)return;let e=t.match(/(linear|radial)-gradient\s*\(\s*([^,]+[^\)]+)\)/i);if(!e||e.length<3)return;this.type=e[1].toLowerCase();let i=e[2].split(",");if(i.length){let t=jmUtils.trim(i[0]).split(/\s+/);if("linear"==this.type?t.length<=2?(this.x2=t[0],this.y2=t[1]||0):(this.x1=t[0],this.y1=t[1],this.x2=t[2],this.y2=t[3]):t.length<=3?(this.x2=t[0],this.y2=t[1]||0,this.r2=t[2]||0):(this.x1=t[0],this.y1=t[1],this.r1=t[2],this.x2=t[3],this.y2=t[3],this.r2=t[3]),i.length>1)for(let t=1;t<i.length;t++){let e=jmUtils.trim(i[t]).split(/\s+/);e.length&&this.addStop(e[1]||0,e[0])}}}toString(){let t=this.type+"-gradient(";return"linear"==this.type?t+=this.x1+" "+this.y1+" "+this.x2+" "+this.y2:t+=this.x1+" "+this.y1+" "+this.r1+" "+this.x2+" "+this.y2+" "+this.r2,this.stops.each(function(e,i){t+=","+i.color+" "+i.offset}),t+")"}}export{jmGradient};class jmShadow{constructor(t,e,i,s){"string"!=typeof t||e||i||s?(this.x=t,this.y=e,this.blur=i,this.color=s):this.fromString(t)}fromString(t){if(!t)return;let e=t.match(/\s*([^,]+)\s*,\s*([^,]+)\s*(,[^,]+)?\s*(,[\s\S]+)?\s*/i);return e&&(this.x=e[1]||0,this.y=e[2]||0,e[3]&&(e[3]=jmUtils.trim(e[3],", "),0===e[3].indexOf("#")||/^rgb/i.test(e[3])?this.color=e[3]:this.blur=jmUtils.trim(e[3],", ")),e[4]&&(this.color=jmUtils.trim(e[4],", "))),this}toString(){let t=this.x+","+this.y;return this.blur&&(t+=","+this.blur),this.color&&(t+=","+this.color),t}}export{jmShadow};class jmControl extends jmProperty{constructor(t,e){t=t||{},super(),this.__pro("type",e||new.target.name),this.style=t&&t.style?t.style:{},this.width=t.width||0,this.height=t.height||0,t.position&&(this.position=t.position),this.graph=t.graph||null,this.zIndex=t.zIndex||0,this.jmStyleMap={fill:"fillStyle",stroke:"strokeStyle","shadow.blur":"shadowBlur","shadow.x":"shadowOffsetX","shadow.y":"shadowOffsetY","shadow.color":"shadowColor",lineWidth:"lineWidth",miterLimit:"miterLimit",fillStyle:"fillStyle",strokeStyle:"strokeStyle",font:"font",opacity:"globalAlpha",textAlign:"textAlign",textBaseline:"textBaseline",shadowBlur:"shadowBlur",shadowOffsetX:"shadowOffsetX",shadowOffsetY:"shadowOffsetY",shadowColor:"shadowColor",lineJoin:"lineJoin",lineCap:"lineCap"},this.initializing(),this.on=this.bind}get type(){return this.__pro("type")}get context(){let t=this.__pro("context");if(t)return t;if(this.is("jmGraph")&&this.canvas)return this.context=this.canvas.getContext("2d");let e=this.graph;return e?e.context:e.canvas.getContext("2d")}set context(t){return this.__pro("context",t)}get style(){let t=this.__pro("style");return t||(t=this.__pro("style",{})),t}set style(t){return this.needUpdate=!0,this.__pro("style",t)}get visible(){let t=this.__pro("visible");return void 0===t&&(t=this.__pro("visible",!0)),t}set visible(t){return this.needUpdate=!0,this.__pro("visible",t)}get children(){let t=this.__pro("children");return t||(t=this.__pro("children",new jmList)),t}set children(t){return this.needUpdate=!0,this.__pro("children",t)}get width(){let t=this.__pro("width");return void 0===t&&(t=this.__pro("width",0)),t}set width(t){return this.needUpdate=!0,this.__pro("width",t)}get height(){let t=this.__pro("height");return void 0===t&&(t=this.__pro("height",0)),t}set height(t){return this.needUpdate=!0,this.__pro("height",t)}get zIndex(){let t=this.__pro("zIndex");return t||(t=this.__pro("zIndex",0)),t}set zIndex(t){return this.needUpdate=!0,this.__pro("zIndex",t),this.children.sort(),this.needUpdate=!0,t}set cursor(t){var e=this.graph;e&&e.css("cursor",t)}get cursor(){var t=this.graph;if(t)return t.css("cursor")}initializing(){var t=this;this.children=this.children||new jmList;var e=this.children.add;this.children.add=function(i){if("object"==typeof i)return i.parent&&i.parent!=t&&i.parent.children&&i.parent.children.remove(i),i.parent=t,this.contain(i)&&this.oremove(i),e.call(this,i),i.emit("add",i),t.needUpdate=!0,t.graph&&(i.graph=t.graph),this.sort(),i},this.children.oremove=this.children.remove,this.children.remove=function(e){"object"==typeof e&&(e.parent=null,e.graph=null,e.remove(!0),this.oremove(e),t.needUpdate=!0)},this.children.sort=function(){var i={};this.each(function(t,e){if(!e)return;let s=e.zIndex;if(!s&&e.style&&e.style.zIndex&&(s=Number(e.style.zIndex),isNaN(s)&&(s=e.style.zIndex||0)),s){(i[s]||(i[s]=[])).push(e)}});for(let t in i)e.call(this,i[t]);t.needUpdate=!0},this.children.clear=function(){this.each(function(t,e){this.remove(e)},!0)},this.needUpdate=!0}setStyle(t){if(!(t=t||this.style))return;let e=(t,i,s)=>{if(t){let n=typeof t,o=this.jmStyleMap[s||i];if(t instanceof jmGradient||"string"==n&&t.indexOf("-gradient")>-1)"string"==n&&t.indexOf("-gradient")>-1&&(t=new jmGradient(t)),e(t.toGradient(this),o||i);else if("function"==n)o&&(t=t.call(this,o))&&e(t,o);else if(o)"string"==n&&["fillStyle","strokeStyle","shadowColor"].indexOf(o)>-1&&(t=jmUtils.toColor(t)),this.context[o]=t;else switch(i){case"shadow":if("string"==n){e(new jmShadow(t),i);break}for(let s in t)e(t[s],s,i+"."+s);break;case"translate":this.context.translate(t.x,t.y);break;case"rotation":{let e=0,i=0;if(t.point){let s=this.absoluteBounds?this.absoluteBounds:this.getAbsoluteBounds();e=(t=this.getRotation(t)).rotateX+s.left,i=t.rotateY+s.top}0==e&&0==i||this.context.translate(e,i),this.context.rotate(t.angle),0==e&&0==i||this.context.translate(-e,-i);break}case"transform":Array.isArray(t)?this.context.transform.apply(this.context,t):"object"==typeof t&&this.context.transform(t.scaleX,t.skewX,t.skewY,t.scaleY,t.offsetX,t.offsetY);break;case"translate":this.context.translate(t.x,t.y);break;case"cursor":this.cursor=t}}};this.translate&&e({translate:this.translate},"translate"),this.transform&&e({transform:this.transform},"transform");for(let i in t){let s=typeof t[i];"string"==s&&t[i].indexOf("-gradient")>-1?t[i]=new jmGradient(t[i]):"string"==s&&"shadow"==i&&(t[i]=new jmShadow(t[i])),e(t[i],i)}}getBounds(t){if(this.bounds&&!t)return this.bounds;let e={};if("jmGraph"==this.type&&this.canvas)"function"==typeof this.canvas.width?e.right=this.canvas.width():this.canvas.width?e.right=this.canvas.width:this.width&&(e.right=this.width),"function"==typeof this.canvas.height?e.bottom=this.canvas.height():this.canvas.height?e.bottom=this.canvas.height:this.height&&(e.bottom=this.height);else if(this.points&&this.points.length>0)for(let t in this.points){let i=this.points[t];(void 0===e.left||e.left>i.x)&&(e.left=i.x),(void 0===e.top||e.top>i.y)&&(e.top=i.y),(void 0===e.right||e.right<i.x)&&(e.right=i.x),(void 0===e.bottom||e.bottom<i.y)&&(e.bottom=i.y)}else if(this.getLocation){let t=this.getLocation();t&&(e.left=t.left,e.top=t.top,e.right=t.left+t.width,e.bottom=t.top+t.height)}return e.left||(e.left=0),e.top||(e.top=0),e.right||(e.right=0),e.bottom||(e.bottom=0),e.width=e.right-e.left,e.height=e.bottom-e.top,this.bounds=e}getLocation(t=!0){let e=this.location={left:0,top:0,width:0,height:0};e.position="function"==typeof this.position?this.position():jmUtils.clone(this.position),e.center=this.center&&"function"==typeof this.center?this.center():jmUtils.clone(this.center),e.start=this.start&&"function"==typeof this.start?this.start():jmUtils.clone(this.start),e.end=this.end&&"function"==typeof this.end?this.end():jmUtils.clone(this.end),e.radius=this.radius,e.width=this.width,e.height=this.height;let i=this.style.margin||{};if(i.left=i.left||0,i.top=i.top||0,i.right=i.right||0,i.bottom=i.bottom||0,e.position?(e.left=e.position.x,e.top=e.position.y):(e.left=i.left,e.top=i.top),!this.parent)return e;let s=this.parent.getBounds();return jmUtils.checkPercent(e.left)&&(e.left=jmUtils.percentToNumber(e.left)*s.width),jmUtils.checkPercent(e.top)&&(e.top=jmUtils.percentToNumber(e.top)*s.height),jmUtils.checkPercent(e.width)&&(e.width=jmUtils.percentToNumber(e.width)*s.width),jmUtils.checkPercent(e.height)&&(e.height=jmUtils.percentToNumber(e.height)*s.height),e.center&&(jmUtils.checkPercent(e.center.x)&&(e.center.x=jmUtils.percentToNumber(e.center.x)*s.width),jmUtils.checkPercent(e.center.y)&&(e.center.y=jmUtils.percentToNumber(e.center.y)*s.height)),e.radius&&jmUtils.checkPercent(e.radius)&&(e.radius=jmUtils.percentToNumber(e.radius)*Math.min(s.width,s.height)),e}getRotation(t){if(t=t||this.style.rotation){let e=this.getBounds();t.rotateX=t.point.x,jmUtils.checkPercent(t.rotateX)&&(t.rotateX=jmUtils.percentToNumber(t.rotateX)*e.width),t.rotateY=t.point.y,jmUtils.checkPercent(t.rotateY)&&(t.rotateY=jmUtils.percentToNumber(t.rotateY)*e.height)}else if(t=this.parent&&this.parent.getRotation?this.parent.getRotation():null){let e=this.getBounds();t.rotateX-=e.left,t.rotateY-=e.top}return t}remove(){this.parent&&this.parent.children.remove(this)}offset(t,e,i,s){i=!1!==i;let n=this.getLocation(!0),o=!1;if(n.position&&(n.left+=t,n.top+=e,this.position.x=n.left,this.position.y=n.top,o=!0),n.center&&(this.center.x=n.center.x+t,this.center.y=n.center.y+e,o=!0),n.start&&"object"==typeof n.start&&(this.start.x=n.start.x+t,this.start.y=n.start.y+e,o=!0),n.end&&"object"==typeof n.end&&(this.end.x=n.end.x+t,this.end.y=n.end.y+e,o=!0),0==o&&this.cpoints){let i=(this.cpoints,this.cpoints);if(i){let s=i.length;for(let n=0;n<s;n++)i[n].x+=t,i[n].y+=e;o=!0}}if(0==o&&this.points){let i=this.points.length;for(let s=0;s<i;s++)this.points[s].x+=t,this.points[s].y+=e;o=!0}this.emit("move",{offsetX:t,offsetY:e,trans:i,evt:s}),this.needUpdate=!0}rotate(t,e){this.style.rotation={angle:t,point:e},this.needUpdate=!0}getAbsoluteBounds(){let t=this.getBounds();if(this.parent&&this.parent.absoluteBounds){let e=this.parent.absoluteBounds||this.parent.getAbsoluteBounds();return{left:e.left+t.left,top:e.top+t.top,right:e.left+t.right,bottom:e.top+t.bottom,width:t.width,height:t.height}}return t}beginDraw(){this.getLocation(!0),this.context.beginPath()}endDraw(){this.style.close&&this.context.closePath(),this.style.fill&&this.context.fill(),!this.style.stroke&&this.style.fill||this.context.stroke(),this.needUpdate=!1}draw(){if(this.points&&this.points.length>0){let t=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds;this.context.moveTo(this.points[0].x+t.left,this.points[0].y+t.top);let e=this.points.length;for(let i=1;i<e;i++){let e=this.points[i];e.m?this.context.moveTo(e.x+t.left,e.y+t.top):this.context.lineTo(e.x+t.left,e.y+t.top)}}}paint(t){if(!1!==t&&!1!==this.visible){this.initPoints&&this.initPoints(),this.bounds=null,this.absoluteBounds=this.getAbsoluteBounds();let t=!0;!this.is("jmGraph")&&this.graph&&(this.absoluteBounds.left>=this.graph.width?t=!1:this.absoluteBounds.top>=this.graph.height?t=!1:this.absoluteBounds.right<=0?t=!1:this.absoluteBounds.bottom<=0&&(t=!1)),this.context.save(),this.setStyle(),this.emit("beginDraw",this),t&&this.beginDraw&&this.beginDraw(),t&&this.draw&&this.draw(),t&&this.endDraw&&this.endDraw(),this.children&&this.children.each(function(t,e){e&&e.paint&&e.paint()}),this.emit("endDraw",this),this.context.restore(),this.is("jmGraph")&&this.context.draw&&this.context.draw(),this.needUpdate=!1}}getEvent(t){return this.__events?this.__events[t]:null}bind(t,e){let i=this.getEvent(t)||function(t,e){return this.__events||(this.__events={}),this.__events[t]=e}.call(this,t,new jmList);i.contain(e)||i.add(e)}unbind(t,e){let i=this.getEvent(t);i&&(e?i.remove(e):i.clear())}emit(...t){return this.runEventHandle(t[0],t.slice(1)),this}runEventHandle(t,e){let i=this.getEvent(t);if(i){var s=this;Array.isArray(e)||(e=[e]),i.each(function(t,i){!1===i.apply(s,e)&&(e.cancel=!0)})}return e.cancel}checkPoint(t,e){if("jmGraph"==this.type){let e=this.getPosition();return!(t.pageX>e.right||t.pageX<e.left)&&!(t.pageY>e.bottom||t.pageY<e.top)}let i=this.getBounds(),s=this.getRotation(),n=this.points;if(n&&n.length||((n=[]).push({x:i.left,y:i.top}),n.push({x:i.right,y:i.top}),n.push({x:i.right,y:i.bottom}),n.push({x:i.left,y:i.bottom}),n.push({x:i.left,y:i.top})),e=Number(e||this.style.touchPadding||this.style.lineWidth||1),n&&n.length){if(s&&0!=s.angle&&(n=jmUtils.clone(n,!0),n=jmUtils.rotatePoints(n,{x:s.rotateX+i.left,y:s.rotateY+i.top},s.angle)),n.length>2&&(!this.style.fill||this.style.stroke)){let i=0,s=n.length;for(let o=i+1;o<=s;o=++i+1)if(o==s){if(this.style.close){if(jmUtils.pointInPolygon(t,[n[i],n[0]],e))return!0}}else{if(jmUtils.pointInPolygon(t,[n[i],n[o]],e))return!0}if(!this.style.fill)return!1}return jmUtils.pointInPolygon(t,n,e)}return!(t.x>i.right||t.x<i.left)&&!(t.y>i.bottom||t.y<i.top)}raiseEvent(t,e){if(!1===this.visible)return;if(!e.position){let t=this.graph,i=jmUtils.getEventPosition(e,t.scaleSize),s=e.srcElement||e.target;e={position:i,button:0==e.button||i.isTouch?1:e.button,keyCode:e.keyCode||e.charCode||e.which,ctrlKey:e.ctrlKey,cancel:!1,srcElement:s}}e.path=e.path||[],this.children&&this.children.each(function(i,s){!0!==e.cancel&&s.raiseEvent(t,e)},!0);let i=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds;return!!i&&(e.position.x=e.position.offsetX-i.left,e.position.y=e.position.offsetY-i.top,this.checkPoint(e.position)?(e.target||(e.target=this),e.path.push(this),!0!==e.cancel&&this.runEventHandle(t,e),this.focused||"mousemove"!=t||(this.focused=!0,this.raiseEvent("mouseover",e))):this.focused&&"mousemove"==t&&(this.focused=!1,this.runEventHandle("mouseleave",e)),0==e.cancel)}clearEvents(t){var e=this.getEvent(t);e&&e.clear}findParent(t){if("string"==typeof t){if(this.type==t)return this}else if(this.is(t))return this;return this.parent?this.parent.findParent(t):null}canMove(t,e){if(!this.__mvMonitor){this.__mvMonitor={},this.__mvMonitor.mouseDown=!1,this.__mvMonitor.curposition={x:0,y:0};var i=this;this.__mvMonitor.mv=function(t){let e=i;if(e.__mvMonitor.mouseDown){e.parent.bounds=null;let i=e.parent.getAbsoluteBounds(),s=t.position.offsetX-e.__mvMonitor.curposition.x,n=t.position.offsetY-e.__mvMonitor.curposition.y;if(e.lockSide){let t=e.bounds||e.getAbsoluteBounds(),o=jmUtils.checkOutSide(i,t,{x:s,y:n});o.left<0?e.lockSide.left&&(s-=o.left):o.right>0&&e.lockSide.right&&(s-=o.right),o.top<0?e.lockSide.top&&(n-=o.top):o.bottom>0&&e.lockSide.bottom&&(n-=o.bottom)}return(s||n)&&(e.offset(s,n,!0,t),e.__mvMonitor.curposition.x=t.position.offsetX,e.__mvMonitor.curposition.y=t.position.offsetY),!1}},this.__mvMonitor.mu=function(t){let e=i;e.__mvMonitor.mouseDown&&(e.__mvMonitor.mouseDown=!1,e.emit("moveend",{position:e.__mvMonitor.curposition}))},this.__mvMonitor.ml=function(){let t=i;if(t.__mvMonitor.mouseDown)return t.__mvMonitor.mouseDown=!1,t.emit("moveend",{position:t.__mvMonitor.curposition}),!1},this.__mvMonitor.md=function(t){if(!this.__mvMonitor.mouseDown&&(0==t.button||1==t.button)){this.__mvMonitor.mouseDown=!0;var e=this.parent.absoluteBounds||this.parent.getAbsoluteBounds();return this.__mvMonitor.curposition.x=t.position.x+e.left,this.__mvMonitor.curposition.y=t.position.y+e.top,this.emit("movestart",{position:this.__mvMonitor.curposition}),t.cancel=!0,!1}}}return e=e||this.graph,!1!==t?(e.bind("mousemove",this.__mvMonitor.mv),e.bind("mouseup",this.__mvMonitor.mu),e.bind("mouseleave",this.__mvMonitor.ml),this.bind("mousedown",this.__mvMonitor.md),e.bind("touchmove",this.__mvMonitor.mv),e.bind("touchend",this.__mvMonitor.mu),this.bind("touchstart",this.__mvMonitor.md)):(e.unbind("mousemove",this.__mvMonitor.mv),e.unbind("mouseup",this.__mvMonitor.mu),e.unbind("mouseleave",this.__mvMonitor.ml),this.unbind("mousedown",this.__mvMonitor.md),e.unbind("touchmove",this.__mvMonitor.mv),e.unbind("touchend",this.__mvMonitor.mu),this.unbind("touchstart",this.__mvMonitor.md)),this}}export{jmControl};class jmPath extends jmControl{constructor(t,e="jmPath"){super(t,e),this.points=t&&t.points?t.points:[]}get points(){return this.__pro("points")}set points(t){return this.needUpdate=!0,this.__pro("points",t)}}export{jmPath};class jmArc extends jmPath{constructor(t,e="jmArc"){t||(t={}),super(t,e),this.center=t.center||{x:0,y:0},this.radius=t.radius||0,this.startAngle=t.start||t.startAngle||0,this.endAngle=t.end||t.endAngle||2*Math.PI,this.anticlockwise=t.anticlockwise||0}get center(){return this.__pro("center")}set center(t){return this.needUpdate=!0,this.__pro("center",t)}get radius(){return this.__pro("radius")}set radius(t){return this.needUpdate=!0,this.__pro("radius",t)}get startAngle(){return this.__pro("startAngle")}set startAngle(t){return this.needUpdate=!0,this.__pro("startAngle",t)}get endAngle(){return this.__pro("endAngle")}set endAngle(t){return this.needUpdate=!0,this.__pro("endAngle",t)}get anticlockwise(){return this.__pro("anticlockwise")}set anticlockwise(t){return this.needUpdate=!0,this.__pro("anticlockwise",t)}initPoints(){let t=this.getLocation(),e=0,i=0,s=t.center.x,n=t.center.y;t.radius?e=i=t.radius:(e=t.width/2,i=t.height/2);let o=this.startAngle,r=this.endAngle;if(0==e&&0==i||o==r)return;let h=this.anticlockwise;this.points=[];let a=1/Math.max(e,i);if(h){let t=2*Math.PI;o=t-o,r=t-r}o>r&&(a=-a);for(let t=o;;t+=a){a>0&&t>r?t=r:a<0&&t<r&&(t=r);let o={x:Math.cos(t)*e+s,y:Math.sin(t)*i+n};if(this.points.push(o),t==r)break}return this.points}}export{jmArc};class jmArc extends jmPath{constructor(t,e="jmArc"){t||(t={}),super(t,e),this.center=t.center||{x:0,y:0},this.radius=t.radius||0,this.startAngle=t.start||t.startAngle||0,this.endAngle=t.end||t.endAngle||2*Math.PI,this.anticlockwise=t.anticlockwise||0}get center(){return this.__pro("center")}set center(t){return this.needUpdate=!0,this.__pro("center",t)}get radius(){return this.__pro("radius")}set radius(t){return this.needUpdate=!0,this.__pro("radius",t)}get startAngle(){return this.__pro("startAngle")}set startAngle(t){return this.needUpdate=!0,this.__pro("startAngle",t)}get endAngle(){return this.__pro("endAngle")}set endAngle(t){return this.needUpdate=!0,this.__pro("endAngle",t)}get anticlockwise(){return this.__pro("anticlockwise")}set anticlockwise(t){return this.needUpdate=!0,this.__pro("anticlockwise",t)}initPoints(){let t=this.getLocation(),e=0,i=0,s=t.center.x,n=t.center.y;t.radius?e=i=t.radius:(e=t.width/2,i=t.height/2);let o=this.startAngle,r=this.endAngle;if(0==e&&0==i||o==r)return;let h=this.anticlockwise;this.points=[];let a=1/Math.max(e,i);if(h){let t=2*Math.PI;o=t-o,r=t-r}o>r&&(a=-a);for(let t=o;;t+=a){a>0&&t>r?t=r:a<0&&t<r&&(t=r);let o={x:Math.cos(t)*e+s,y:Math.sin(t)*i+n};if(this.points.push(o),t==r)break}return this.points}}export{jmArc};class jmArraw extends jmPath{constructor(t,e="jmArraw"){super(t,e),this.style.lineJoin="miter",this.style.lineCap="square",this.angle=t.angle||0,this.start=t.start||{x:0,y:0},this.end=t.end||{x:0,y:0},this.offsetX=t.offsetX||5,this.offsetY=t.offsetY||8}get start(){return this.__pro("start")}set start(t){return this.needUpdate=!0,this.__pro("start",t)}get end(){return this.__pro("end")}set end(t){return this.needUpdate=!0,this.__pro("end",t)}get angle(){return this.__pro("angle")}set angle(t){return this.needUpdate=!0,this.__pro("angle",t)}get offsetX(){return this.__pro("offsetX")}set offsetX(t){return this.needUpdate=!0,this.__pro("offsetX",t)}get offsetY(){return this.__pro("offsetY")}set offsetY(t){return this.needUpdate=!0,this.__pro("offsetY",t)}initPoints(t){let e=this.angle,i=this.start,s=this.end;if(!s)return;e||(e=Math.atan2(s.y-i.y,s.x-i.x)),this.points=[];let n=this.offsetX,o=this.offsetY,r=Math.atan2(n,o),h=e+r,a=Math.sin(h),l=Math.cos(h),c=Math.sqrt(n*n+o*o),d=a*c,p=l*c,u={x:s.x-p,y:s.y-d},m=e-r;d=(a=Math.sin(m))*c,p=(l=Math.cos(m))*c;let f={x:s.x-p,y:s.y-d},g=jmUtils.clone(s);return g.m=!0,this.points.push(g),this.points.push(u),t||this.style.fill?(this.points.push(f),this.points.push(s)):(this.points.push(g),this.points.push(f)),this.points}}export{jmArraw};class jmBezier extends jmPath{constructor(t,e="jmBezier"){super(t,e),this.cpoints=t.points||[]}get cpoints(){return this.__pro("cpoints")}set cpoints(t){return this.needUpdate=!0,this.__pro("cpoints",t)}initPoints(){this.points=[];let t=this.cpoints;for(let e=0;e<=1;e+=.01){let i=this.getPoint(t,e);this.points.push(i)}return this.points.push(t[t.length-1]),this.points}getPoint(t,e){if(1==t.length)return t[0];if(2==t.length){let i={};return i.x=(t[1].x-t[0].x)*e+t[0].x,i.y=(t[1].y-t[0].y)*e+t[0].y,i}if(t.length>2){let i=[];for(let s=0;s<t.length-1;s++){let n=this.getPoint([t[s],t[s+1]],e);n&&i.push(n)}return this.getPoint(i,e)}}offset(t,e,i){let s=this.cpoints;if(s){let n=s.length;for(let i=0;i<n;i++)s[i].x+=t,s[i].y+=e;this.emit("move",{offsetX:t,offsetY:e,trans:i}),this.getLocation(!0)}}}export{jmBezier};class jmCircle extends jmArc{constructor(t,e="jmCircle"){super(t,e)}initPoints(){let t=this.getLocation();t.radius||(t.radius=Math.min(t.width,t.height)/2),this.points=[],this.points.push({x:t.center.x-t.radius,y:t.center.y-t.radius}),this.points.push({x:t.center.x+t.radius,y:t.center.y-t.radius}),this.points.push({x:t.center.x+t.radius,y:t.center.y+t.radius}),this.points.push({x:t.center.x-t.radius,y:t.center.y+t.radius})}draw(){let t=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds,e=this.getLocation();e.radius||(e.radius=Math.min(e.width,e.height)/2);let i=this.startAngle,s=this.endAngle,n=this.anticlockwise;this.context.arc(e.center.x+t.left,e.center.y+t.top,e.radius,i,s,n)}}export{jmCircle};class jmControl extends jmProperty{constructor(t,e){t=t||{},super(),this.__pro("type",e||new.target.name),this.style=t&&t.style?t.style:{},this.width=t.width||0,this.height=t.height||0,t.position&&(this.position=t.position),this.graph=t.graph||null,this.zIndex=t.zIndex||0,this.jmStyleMap={fill:"fillStyle",stroke:"strokeStyle","shadow.blur":"shadowBlur","shadow.x":"shadowOffsetX","shadow.y":"shadowOffsetY","shadow.color":"shadowColor",lineWidth:"lineWidth",miterLimit:"miterLimit",fillStyle:"fillStyle",strokeStyle:"strokeStyle",font:"font",opacity:"globalAlpha",textAlign:"textAlign",textBaseline:"textBaseline",shadowBlur:"shadowBlur",shadowOffsetX:"shadowOffsetX",shadowOffsetY:"shadowOffsetY",shadowColor:"shadowColor",lineJoin:"lineJoin",lineCap:"lineCap"},this.initializing(),this.on=this.bind}get type(){return this.__pro("type")}get context(){let t=this.__pro("context");if(t)return t;if(this.is("jmGraph")&&this.canvas)return this.context=this.canvas.getContext("2d");let e=this.graph;return e?e.context:e.canvas.getContext("2d")}set context(t){return this.__pro("context",t)}get style(){let t=this.__pro("style");return t||(t=this.__pro("style",{})),t}set style(t){return this.needUpdate=!0,this.__pro("style",t)}get visible(){let t=this.__pro("visible");return void 0===t&&(t=this.__pro("visible",!0)),t}set visible(t){return this.needUpdate=!0,this.__pro("visible",t)}get children(){let t=this.__pro("children");return t||(t=this.__pro("children",new jmList)),t}set children(t){return this.needUpdate=!0,this.__pro("children",t)}get width(){let t=this.__pro("width");return void 0===t&&(t=this.__pro("width",0)),t}set width(t){return this.needUpdate=!0,this.__pro("width",t)}get height(){let t=this.__pro("height");return void 0===t&&(t=this.__pro("height",0)),t}set height(t){return this.needUpdate=!0,this.__pro("height",t)}get zIndex(){let t=this.__pro("zIndex");return t||(t=this.__pro("zIndex",0)),t}set zIndex(t){return this.needUpdate=!0,this.__pro("zIndex",t),this.children.sort(),this.needUpdate=!0,t}set cursor(t){var e=this.graph;e&&e.css("cursor",t)}get cursor(){var t=this.graph;if(t)return t.css("cursor")}initializing(){var t=this;this.children=this.children||new jmList;var e=this.children.add;this.children.add=function(i){if("object"==typeof i)return i.parent&&i.parent!=t&&i.parent.children&&i.parent.children.remove(i),i.parent=t,this.contain(i)&&this.oremove(i),e.call(this,i),i.emit("add",i),t.needUpdate=!0,t.graph&&(i.graph=t.graph),this.sort(),i},this.children.oremove=this.children.remove,this.children.remove=function(e){"object"==typeof e&&(e.parent=null,e.graph=null,e.remove(!0),this.oremove(e),t.needUpdate=!0)},this.children.sort=function(){var i={};this.each(function(t,e){if(!e)return;let s=e.zIndex;if(!s&&e.style&&e.style.zIndex&&(s=Number(e.style.zIndex),isNaN(s)&&(s=e.style.zIndex||0)),s){(i[s]||(i[s]=[])).push(e)}});for(let t in i)e.call(this,i[t]);t.needUpdate=!0},this.children.clear=function(){this.each(function(t,e){this.remove(e)},!0)},this.needUpdate=!0}setStyle(t){if(!(t=t||this.style))return;let e=(t,i,s)=>{if(t){let n=typeof t,o=this.jmStyleMap[s||i];if(t instanceof jmGradient||"string"==n&&t.indexOf("-gradient")>-1)"string"==n&&t.indexOf("-gradient")>-1&&(t=new jmGradient(t)),e(t.toGradient(this),o||i);else if("function"==n)o&&(t=t.call(this,o))&&e(t,o);else if(o)"string"==n&&["fillStyle","strokeStyle","shadowColor"].indexOf(o)>-1&&(t=jmUtils.toColor(t)),this.context[o]=t;else switch(i){case"shadow":if("string"==n){e(new jmShadow(t),i);break}for(let s in t)e(t[s],s,i+"."+s);break;case"translate":this.context.translate(t.x,t.y);break;case"rotation":{let e=0,i=0;if(t.point){let s=this.absoluteBounds?this.absoluteBounds:this.getAbsoluteBounds();e=(t=this.getRotation(t)).rotateX+s.left,i=t.rotateY+s.top}0==e&&0==i||this.context.translate(e,i),this.context.rotate(t.angle),0==e&&0==i||this.context.translate(-e,-i);break}case"transform":Array.isArray(t)?this.context.transform.apply(this.context,t):"object"==typeof t&&this.context.transform(t.scaleX,t.skewX,t.skewY,t.scaleY,t.offsetX,t.offsetY);break;case"translate":this.context.translate(t.x,t.y);break;case"cursor":this.cursor=t}}};this.translate&&e({translate:this.translate},"translate"),this.transform&&e({transform:this.transform},"transform");for(let i in t){let s=typeof t[i];"string"==s&&t[i].indexOf("-gradient")>-1?t[i]=new jmGradient(t[i]):"string"==s&&"shadow"==i&&(t[i]=new jmShadow(t[i])),e(t[i],i)}}getBounds(t){if(this.bounds&&!t)return this.bounds;let e={};if("jmGraph"==this.type&&this.canvas)"function"==typeof this.canvas.width?e.right=this.canvas.width():this.canvas.width?e.right=this.canvas.width:this.width&&(e.right=this.width),"function"==typeof this.canvas.height?e.bottom=this.canvas.height():this.canvas.height?e.bottom=this.canvas.height:this.height&&(e.bottom=this.height);else if(this.points&&this.points.length>0)for(let t in this.points){let i=this.points[t];(void 0===e.left||e.left>i.x)&&(e.left=i.x),(void 0===e.top||e.top>i.y)&&(e.top=i.y),(void 0===e.right||e.right<i.x)&&(e.right=i.x),(void 0===e.bottom||e.bottom<i.y)&&(e.bottom=i.y)}else if(this.getLocation){let t=this.getLocation();t&&(e.left=t.left,e.top=t.top,e.right=t.left+t.width,e.bottom=t.top+t.height)}return e.left||(e.left=0),e.top||(e.top=0),e.right||(e.right=0),e.bottom||(e.bottom=0),e.width=e.right-e.left,e.height=e.bottom-e.top,this.bounds=e}getLocation(t=!0){let e=this.location={left:0,top:0,width:0,height:0};e.position="function"==typeof this.position?this.position():jmUtils.clone(this.position),e.center=this.center&&"function"==typeof this.center?this.center():jmUtils.clone(this.center),e.start=this.start&&"function"==typeof this.start?this.start():jmUtils.clone(this.start),e.end=this.end&&"function"==typeof this.end?this.end():jmUtils.clone(this.end),e.radius=this.radius,e.width=this.width,e.height=this.height;let i=this.style.margin||{};if(i.left=i.left||0,i.top=i.top||0,i.right=i.right||0,i.bottom=i.bottom||0,e.position?(e.left=e.position.x,e.top=e.position.y):(e.left=i.left,e.top=i.top),!this.parent)return e;let s=this.parent.getBounds();return jmUtils.checkPercent(e.left)&&(e.left=jmUtils.percentToNumber(e.left)*s.width),jmUtils.checkPercent(e.top)&&(e.top=jmUtils.percentToNumber(e.top)*s.height),jmUtils.checkPercent(e.width)&&(e.width=jmUtils.percentToNumber(e.width)*s.width),jmUtils.checkPercent(e.height)&&(e.height=jmUtils.percentToNumber(e.height)*s.height),e.center&&(jmUtils.checkPercent(e.center.x)&&(e.center.x=jmUtils.percentToNumber(e.center.x)*s.width),jmUtils.checkPercent(e.center.y)&&(e.center.y=jmUtils.percentToNumber(e.center.y)*s.height)),e.radius&&jmUtils.checkPercent(e.radius)&&(e.radius=jmUtils.percentToNumber(e.radius)*Math.min(s.width,s.height)),e}getRotation(t){if(t=t||this.style.rotation){let e=this.getBounds();t.rotateX=t.point.x,jmUtils.checkPercent(t.rotateX)&&(t.rotateX=jmUtils.percentToNumber(t.rotateX)*e.width),t.rotateY=t.point.y,jmUtils.checkPercent(t.rotateY)&&(t.rotateY=jmUtils.percentToNumber(t.rotateY)*e.height)}else if(t=this.parent&&this.parent.getRotation?this.parent.getRotation():null){let e=this.getBounds();t.rotateX-=e.left,t.rotateY-=e.top}return t}remove(){this.parent&&this.parent.children.remove(this)}offset(t,e,i,s){i=!1!==i;let n=this.getLocation(!0),o=!1;if(n.position&&(n.left+=t,n.top+=e,this.position.x=n.left,this.position.y=n.top,o=!0),n.center&&(this.center.x=n.center.x+t,this.center.y=n.center.y+e,o=!0),n.start&&"object"==typeof n.start&&(this.start.x=n.start.x+t,this.start.y=n.start.y+e,o=!0),n.end&&"object"==typeof n.end&&(this.end.x=n.end.x+t,this.end.y=n.end.y+e,o=!0),0==o&&this.cpoints){let i=(this.cpoints,this.cpoints);if(i){let s=i.length;for(let n=0;n<s;n++)i[n].x+=t,i[n].y+=e;o=!0}}if(0==o&&this.points){let i=this.points.length;for(let s=0;s<i;s++)this.points[s].x+=t,this.points[s].y+=e;o=!0}this.emit("move",{offsetX:t,offsetY:e,trans:i,evt:s}),this.needUpdate=!0}rotate(t,e){this.style.rotation={angle:t,point:e},this.needUpdate=!0}getAbsoluteBounds(){let t=this.getBounds();if(this.parent&&this.parent.absoluteBounds){let e=this.parent.absoluteBounds||this.parent.getAbsoluteBounds();return{left:e.left+t.left,top:e.top+t.top,right:e.left+t.right,bottom:e.top+t.bottom,width:t.width,height:t.height}}return t}beginDraw(){this.getLocation(!0),this.context.beginPath()}endDraw(){this.style.close&&this.context.closePath(),this.style.fill&&this.context.fill(),!this.style.stroke&&this.style.fill||this.context.stroke(),this.needUpdate=!1}draw(){if(this.points&&this.points.length>0){let t=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds;this.context.moveTo(this.points[0].x+t.left,this.points[0].y+t.top);let e=this.points.length;for(let i=1;i<e;i++){let e=this.points[i];e.m?this.context.moveTo(e.x+t.left,e.y+t.top):this.context.lineTo(e.x+t.left,e.y+t.top)}}}paint(t){if(!1!==t&&!1!==this.visible){this.initPoints&&this.initPoints(),this.bounds=null,this.absoluteBounds=this.getAbsoluteBounds();let t=!0;!this.is("jmGraph")&&this.graph&&(this.absoluteBounds.left>=this.graph.width?t=!1:this.absoluteBounds.top>=this.graph.height?t=!1:this.absoluteBounds.right<=0?t=!1:this.absoluteBounds.bottom<=0&&(t=!1)),this.context.save(),this.setStyle(),this.emit("beginDraw",this),t&&this.beginDraw&&this.beginDraw(),t&&this.draw&&this.draw(),t&&this.endDraw&&this.endDraw(),this.children&&this.children.each(function(t,e){e&&e.paint&&e.paint()}),this.emit("endDraw",this),this.context.restore(),this.is("jmGraph")&&this.context.draw&&this.context.draw(),this.needUpdate=!1}}getEvent(t){return this.__events?this.__events[t]:null}bind(t,e){let i=this.getEvent(t)||function(t,e){return this.__events||(this.__events={}),this.__events[t]=e}.call(this,t,new jmList);i.contain(e)||i.add(e)}unbind(t,e){let i=this.getEvent(t);i&&(e?i.remove(e):i.clear())}emit(...t){return this.runEventHandle(t[0],t.slice(1)),this}runEventHandle(t,e){let i=this.getEvent(t);if(i){var s=this;Array.isArray(e)||(e=[e]),i.each(function(t,i){!1===i.apply(s,e)&&(e.cancel=!0)})}return e.cancel}checkPoint(t,e){if("jmGraph"==this.type){let e=this.getPosition();return!(t.pageX>e.right||t.pageX<e.left)&&!(t.pageY>e.bottom||t.pageY<e.top)}let i=this.getBounds(),s=this.getRotation(),n=this.points;if(n&&n.length||((n=[]).push({x:i.left,y:i.top}),n.push({x:i.right,y:i.top}),n.push({x:i.right,y:i.bottom}),n.push({x:i.left,y:i.bottom}),n.push({x:i.left,y:i.top})),e=Number(e||this.style.touchPadding||this.style.lineWidth||1),n&&n.length){if(s&&0!=s.angle&&(n=jmUtils.clone(n,!0),n=jmUtils.rotatePoints(n,{x:s.rotateX+i.left,y:s.rotateY+i.top},s.angle)),n.length>2&&(!this.style.fill||this.style.stroke)){let i=0,s=n.length;for(let o=i+1;o<=s;o=++i+1)if(o==s){if(this.style.close){if(jmUtils.pointInPolygon(t,[n[i],n[0]],e))return!0}}else{if(jmUtils.pointInPolygon(t,[n[i],n[o]],e))return!0}if(!this.style.fill)return!1}return jmUtils.pointInPolygon(t,n,e)}return!(t.x>i.right||t.x<i.left)&&!(t.y>i.bottom||t.y<i.top)}raiseEvent(t,e){if(!1===this.visible)return;if(!e.position){let t=this.graph,i=jmUtils.getEventPosition(e,t.scaleSize),s=e.srcElement||e.target;e={position:i,button:0==e.button||i.isTouch?1:e.button,keyCode:e.keyCode||e.charCode||e.which,ctrlKey:e.ctrlKey,cancel:!1,srcElement:s}}e.path=e.path||[],this.children&&this.children.each(function(i,s){!0!==e.cancel&&s.raiseEvent(t,e)},!0);let i=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds;return!!i&&(e.position.x=e.position.offsetX-i.left,e.position.y=e.position.offsetY-i.top,this.checkPoint(e.position)?(e.target||(e.target=this),e.path.push(this),!0!==e.cancel&&this.runEventHandle(t,e),this.focused||"mousemove"!=t||(this.focused=!0,this.raiseEvent("mouseover",e))):this.focused&&"mousemove"==t&&(this.focused=!1,this.runEventHandle("mouseleave",e)),0==e.cancel)}clearEvents(t){var e=this.getEvent(t);e&&e.clear}findParent(t){if("string"==typeof t){if(this.type==t)return this}else if(this.is(t))return this;return this.parent?this.parent.findParent(t):null}canMove(t,e){if(!this.__mvMonitor){this.__mvMonitor={},this.__mvMonitor.mouseDown=!1,this.__mvMonitor.curposition={x:0,y:0};var i=this;this.__mvMonitor.mv=function(t){let e=i;if(e.__mvMonitor.mouseDown){e.parent.bounds=null;let i=e.parent.getAbsoluteBounds(),s=t.position.offsetX-e.__mvMonitor.curposition.x,n=t.position.offsetY-e.__mvMonitor.curposition.y;if(e.lockSide){let t=e.bounds||e.getAbsoluteBounds(),o=jmUtils.checkOutSide(i,t,{x:s,y:n});o.left<0?e.lockSide.left&&(s-=o.left):o.right>0&&e.lockSide.right&&(s-=o.right),o.top<0?e.lockSide.top&&(n-=o.top):o.bottom>0&&e.lockSide.bottom&&(n-=o.bottom)}return(s||n)&&(e.offset(s,n,!0,t),e.__mvMonitor.curposition.x=t.position.offsetX,e.__mvMonitor.curposition.y=t.position.offsetY),!1}},this.__mvMonitor.mu=function(t){let e=i;e.__mvMonitor.mouseDown&&(e.__mvMonitor.mouseDown=!1,e.emit("moveend",{position:e.__mvMonitor.curposition}))},this.__mvMonitor.ml=function(){let t=i;if(t.__mvMonitor.mouseDown)return t.__mvMonitor.mouseDown=!1,t.emit("moveend",{position:t.__mvMonitor.curposition}),!1},this.__mvMonitor.md=function(t){if(!this.__mvMonitor.mouseDown&&(0==t.button||1==t.button)){this.__mvMonitor.mouseDown=!0;var e=this.parent.absoluteBounds||this.parent.getAbsoluteBounds();return this.__mvMonitor.curposition.x=t.position.x+e.left,this.__mvMonitor.curposition.y=t.position.y+e.top,this.emit("movestart",{position:this.__mvMonitor.curposition}),t.cancel=!0,!1}}}return e=e||this.graph,!1!==t?(e.bind("mousemove",this.__mvMonitor.mv),e.bind("mouseup",this.__mvMonitor.mu),e.bind("mouseleave",this.__mvMonitor.ml),this.bind("mousedown",this.__mvMonitor.md),e.bind("touchmove",this.__mvMonitor.mv),e.bind("touchend",this.__mvMonitor.mu),this.bind("touchstart",this.__mvMonitor.md)):(e.unbind("mousemove",this.__mvMonitor.mv),e.unbind("mouseup",this.__mvMonitor.mu),e.unbind("mouseleave",this.__mvMonitor.ml),this.unbind("mousedown",this.__mvMonitor.md),e.unbind("touchmove",this.__mvMonitor.mv),e.unbind("touchend",this.__mvMonitor.mu),this.unbind("touchstart",this.__mvMonitor.md)),this}}export{jmControl};class jmHArc extends jmArc{constructor(t,e="jmHArc"){super(t,e),this.minRadius=t.minRadius||style.minRadius||0,this.maxRadius=t.maxRadius||style.maxRadius||0}get minRadius(){return this.__pro("minRadius")}set minRadius(t){return this.needUpdate=!0,this.__pro("minRadius",t)}get maxRadius(){return this.__pro("maxRadius")}set maxRadius(t){return this.needUpdate=!0,this.__pro("maxRadius",t)}initPoints(){let t=this.getLocation(),e=this.minRadius,i=this.maxRadius,s=this.startAngle,n=this.endAngle;if(this.anticlockwise){let t=2*Math.PI;s=t-s,n=t-n}let o=.1;s>n&&(o=-o);let r=[],h=[];for(let a=s;!(o>0&&a>=n)&&!(o<0&&a<=n);a+=o){let s=Math.cos(a),n=Math.sin(a),o={x:s*e+t.center.x,y:n*e+t.center.y},l={x:s*i+t.center.x,y:n*i+t.center.y};r.push(o),h.push(l)}h.reverse(),this.style&&this.style.close||(h[0].m=!0),this.points=r.concat(h)}}export{jmHArc};class jmLine extends jmPath{constructor(t,e="jmLine"){super(t,e),this.start=t.start||{x:0,y:0},this.end=t.end||{x:0,y:0},this.style.lineType=this.style.lineType||"solid",this.style.dashLength=this.style.dashLength||4}get start(){return this.__pro("start")}set start(t){return this.needUpdate=!0,this.__pro("start",t)}get end(){return this.__pro("end")}set end(t){return this.needUpdate=!0,this.__pro("end",t)}initPoints(){let t=this.start,e=this.end;if(this.points=[],this.points.push(t),"dotted"===this.style.lineType){let i=e.x-t.x,s=e.y-t.y,n=Math.sqrt(i*i+s*s);i/=n,s/=n;let o=!1,r=this.style.dashLength||5,h=r/2;for(let e=r;e<=n;)0==o?(this.points.push({x:t.x+i*e,y:t.y+s*e}),e+=h):(this.points.push({x:t.x+i*e,y:t.y+s*e,m:!0}),e+=r),o=!o}return this.points.push(e),this.points}}export{jmLine};class jmPath extends jmControl{constructor(t,e="jmPath"){super(t,e),this.points=t&&t.points?t.points:[]}get points(){return this.__pro("points")}set points(t){return this.needUpdate=!0,this.__pro("points",t)}}export{jmPath};class jmPrismatic extends jmPath{constructor(t,e="jmPrismatic"){super(t,e),this.style.close=void 0===this.style.close||this.style.close,this.center=t.center||{x:0,y:0},this.width=t.width||0,this.height=t.height||0}get center(){return this.__pro("center")}set center(t){return this.needUpdate=!0,this.__pro("center",t)}initPoints(){let t=this.getLocation(),e=t.width/2,i=t.height/2;this.points=[],this.points.push({x:t.center.x-e,y:t.center.y}),this.points.push({x:t.center.x,y:t.center.y+i}),this.points.push({x:t.center.x+e,y:t.center.y}),this.points.push({x:t.center.x,y:t.center.y-i})}}export{jmPrismatic};class jmRect extends jmPath{constructor(t,e="jmRect"){super(t=t||{},e),this.style.close=!0,this.radius=t.radius||this.style.radius||0}get radius(){return this.__pro("radius")}set radius(t){return this.needUpdate=!0,this.__pro("radius",t)}get position(){return this.__pro("position")}set position(t){return this.needUpdate=!0,this.__pro("position",t)}getBounds(){let t={};this.initPoints();let e=this.getLocation();return t.left=e.left,t.top=e.top,t.right=e.left+e.width,t.bottom=e.top+e.height,t.width=t.right-t.left,t.height=t.bottom-t.top,t}initPoints(){let t=this.getLocation(),e={x:t.left,y:t.top},i={x:t.left+t.width,y:t.top},s={x:t.left+t.width,y:t.top+t.height},n={x:t.left,y:t.top+t.height};if("dotted"!==this.style.lineType||this.dottedLine||(this.dottedLine=this.graph.createShape("line",{style:this.style})),t.radius&&t.radius<t.width/2&&t.radius<t.height/2){let e=Math.PI/2,o=this.graph.createShape("arc",{radius:t.radius,anticlockwise:!1});o.center={x:t.left+t.radius,y:t.top+t.radius},o.startAngle=Math.PI,o.endAngle=Math.PI+e;let r=o.initPoints();(o=this.graph.createShape("arc",{radius:t.radius,anticlockwise:!1})).center={x:i.x-t.radius,y:i.y+t.radius},o.startAngle=Math.PI+e,o.endAngle=2*Math.PI;let h=o.initPoints();(o=this.graph.createShape("arc",{radius:t.radius,anticlockwise:!1})).center={x:s.x-t.radius,y:s.y-t.radius},o.startAngle=0,o.endAngle=e;let a=o.initPoints();(o=this.graph.createShape("arc",{radius:t.radius,anticlockwise:!1})).center={x:n.x+t.radius,y:n.y-t.radius},o.startAngle=e,o.endAngle=Math.PI;let l=o.initPoints();this.points=r.concat(h,a,l)}else this.points=[],this.points.push(e),this.dottedLine&&(this.dottedLine.start=e,this.dottedLine.end=i,this.points=this.points.concat(this.dottedLine.initPoints())),this.points.push(i),this.dottedLine&&(this.dottedLine.start=i,this.dottedLine.end=s,this.points=this.points.concat(this.dottedLine.initPoints())),this.points.push(s),this.dottedLine&&(this.dottedLine.start=s,this.dottedLine.end=n,this.points=this.points.concat(this.dottedLine.initPoints())),this.points.push(n),this.dottedLine&&(this.dottedLine.start=n,this.dottedLine.end=e,this.points=this.points.concat(this.dottedLine.initPoints()));return this.points}}export{jmRect};class jmArrawLine extends jmLine{constructor(t,e){super(t,e||"jmArrawLine"),this.style.lineJoin=this.style.lineJoin||"miter",this.arraw=new jmArraw(t)}initPoints(){return this.points=super.initPoints(),!1!==this.arrawVisible&&(this.points=this.points.concat(this.arraw.initPoints())),this.points}}export{jmArrawLine};class jmImage extends jmControl{constructor(t,e){super(t=t||{},e||"jmImage"),this.style.fill=this.fill||"transparent",this.sourceWidth=t.sourceWidth,this.sourceHeight=t.sourceHeight,this.sourcePosition=t.sourcePosition,this.image=t.image||this.style.image}get sourcePosition(){return this.__pro("sourcePosition")}set sourcePosition(t){return this.__pro("sourcePosition",t)}get sourceWidth(){return this.__pro("sourceWidth")}set sourceWidth(t){return this.needUpdate=!0,this.__pro("sourceWidth",t)}get sourceHeight(){return this.__pro("sourceHeight")}set sourceHeight(t){return this.needUpdate=!0,this.__pro("sourceHeight",t)}get image(){return this.__pro("image")}set image(t){return this.needUpdate=!0,this.__pro("image",t)}draw(){try{let t=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds;t||(t=this.parent&&this.parent.getAbsoluteBounds?this.parent.getAbsoluteBounds():this.getAbsoluteBounds());let e=this.getLocation();e.left+=t.left,e.top+=t.top;let i=this.sourcePosition,s=this.sourceWidth,n=this.sourceHeight,o=this.getImage();i||void 0!==s||void 0!==n?(void 0===s&&(s=e.width||o.width||0),void 0===n&&(n=e.height||o.height||0),i=i||{x:0,y:0},e.width&&e.height?this.context.drawImage(o,i.x,i.y,s,n,e.left,e.top,e.width,e.height):e.width?this.context.drawImage(o,i.x,i.y,s,n,e.left,e.top,e.width,n):e.height?this.context.drawImage(o,i.x,i.y,s,n,e.left,e.top,s,e.height):this.context.drawImage(o,i.x,i.y,s,n,e.left,e.top,s,n)):e?e.width&&e.height?this.context.drawImage(o,e.left,e.top,e.width,e.height):e.width?this.context.drawImage(o,e.left,e.top,e.width,o.height):e.height?this.context.drawImage(o,e.left,e.top,o.width,e.height):this.context.drawImage(o,e.left,e.top):this.context.drawImage(o)}catch(t){console.error&&console.error(t)}}getBounds(){let t={},e=this.getImage(),i=this.getLocation(),s=i.width||e.width,n=i.height||e.height;return t.left=i.left,t.top=i.top,t.right=i.left+s,t.bottom=i.top+n,t.width=s,t.height=n,t}getImage(){let t=this.image||this.style.src||this.style.image;return this.__img&&this.__img.src&&-1!=this.__img.src.indexOf(t)?this.__img:(t&&t.src?this.__img=t:document&&document.createElement?(this.__img=document.createElement("img"),t&&"string"==typeof t&&(this.__img.src=t)):this.__img=t,this.__img)}}export{jmImage};class jmLabel extends jmControl{constructor(t,e){super(t=t||{},e||"jmLabel"),this.style.font=this.style.font||"15px Arial",this.style.fontFamily=this.style.fontFamily||"Arial",this.style.fontSize=this.style.fontSize||15,this.style.textAlign=this.style.textAlign||"left",this.style.textBaseline=this.style.textBaseline||"middle",this.text=t.text||"",this.center=t.center||null}get text(){return this.__pro("text")}set text(t){return this.needUpdate=!0,this.__pro("text",t)}get center(){return this.__pro("center")}set center(t){return this.needUpdate=!0,this.__pro("center",t)}get position(){return this.__pro("position")}set position(t){return this.needUpdate=!0,this.__pro("position",t)}getLocation(){let t=super.getLocation(),e=this.testSize();return t.width=t.width||e.width,t.height=t.height||e.height,t.left||t.top||!t.center||(t.left=t.center.x-t.width/2,t.top=t.center.y-t.height/2),t}initPoints(){this.__size=null;let t=this.getLocation();return this.points=[{x:t.left,y:t.top}],this.points.push({x:t.left+t.width,y:t.top}),this.points.push({x:t.left+t.width,y:t.top+t.height}),this.points.push({x:t.left,y:t.top+t.height}),this.points}testSize(){return this.__size?this.__size:(this.style.font=this.style.fontSize+"px "+this.style.fontFamily,this.context.save(),this.setStyle(),this.__size=this.context.measureText?this.context.measureText(this.text):{width:15},this.context.restore(),this.__size.height=this.style.fontSize?this.style.fontSize:15,this.width||(this.width=this.__size.width),this.height||(this.height=this.__size.height),this.__size)}draw(){let t=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds,e=(this.testSize(),this.location),i=e.left+t.left,s=e.top+t.top;switch(this.style.textAlign){case"right":i+=e.width;break;case"center":i+=e.width/2}switch(this.style.textBaseline){case"bottom":s+=e.height;break;case"hanging":case"alphabetic":case"middle":s+=e.height/2}let n=this.text;n&&(this.style.fill&&this.context.fillText?this.style.maxWidth?this.context.fillText(n,i,s,this.style.maxWidth):this.context.fillText(n,i,s):this.context.strokeText&&(this.style.maxWidth?this.context.strokeText(n,i,s,this.style.maxWidth):this.context.strokeText(n,i,s))),this.style.border&&(this.style.border.style&&(this.context.save(),this.setStyle(this.style.border.style)),this.context.moveTo(this.points[0].x+t.left,this.points[0].y+t.top),this.style.border.top&&this.context.lineTo(this.points[1].x+t.left,this.points[1].y+t.top),this.style.border.right&&(this.context.moveTo(this.points[1].x+t.left,this.points[1].y+t.top),this.context.lineTo(this.points[2].x+t.left,this.points[2].y+t.top)),this.style.border.bottom&&(this.context.moveTo(this.points[2].x+t.left,this.points[2].y+t.top),this.context.lineTo(this.points[3].x+t.left,this.points[3].y+t.top)),this.style.border.left&&(this.context.moveTo(this.points[3].x+t.left,this.points[3].y+t.top),this.context.lineTo(this.points[0].x+t.left,this.points[0].y+t.top)),this.style.border.style&&this.context.restore())}}export{jmLabel};class jmResize extends jmRect{constructor(t,e="jmResize"){super(t=t||{},e),this.resizable=!1!==t.resizable,this.movable=t.movable,this.rectSize=t.rectSize||8,this.style.close=this.style.close||!0,this.init(t)}get rectSize(){return this.__pro("rectSize")}set rectSize(t){return this.__pro("rectSize",t)}get resizable(){return this.__pro("resizable")}set resizable(t){return this.__pro("resizable",t)}init(t){if(!1===this.resizable)return;this.resizeRects=[];let e=this.rectSize,i=this.style.rectStyle||{stroke:"red",fill:"transparent",lineWidth:2,close:!0,zIndex:100};i.close=!0,i.fill=i.fill||"transparent";for(let s=0;s<8;s++){let n=(this.graph||t.graph).createShape("rect",{position:{x:0,y:0},width:e,height:e,style:i});n.index=s,n.visible=!0,this.resizeRects.push(n),this.children.add(n),n.canMove(!0,this.graph)}this.reset(0,0,0,0),this.bindRectEvents()}bindRectEvents(){for(let t=0;t<this.resizeRects.length;t++){let e=this.resizeRects[t];e.on("move",function(t){let e=0,i=0,s=0,n=0;0==this.index?(s=-t.offsetX,e=t.offsetX):1==this.index?(s=-t.offsetX,e=t.offsetX,n=-t.offsetY,i=t.offsetY):2==this.index?(n=-t.offsetY,i=t.offsetY):3==this.index?(s=t.offsetX,n=-t.offsetY,i=t.offsetY):4==this.index?s=t.offsetX:5==this.index?(s=t.offsetX,n=t.offsetY):6==this.index?n=t.offsetY:7==this.index&&(s=-t.offsetX,s=-t.offsetX,e=t.offsetX,n=t.offsetY),this.parent.reset(e,i,s,n),this.needUpdate=!0}),e.bind("mousemove",function(){this.cursor=["w-resize","nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize"][this.index]}),e.bind("mouseleave",function(){this.cursor="default"})}}reset(t,e,i,s){let n=void 0===this.style.minWidth?5:this.style.minWidth,o=void 0===this.style.minHeight?5:this.style.minHeight,r=this.getLocation();if(0!=i||0!=s){let h=r.width+i,a=r.height+s;if(h>=n||a>=o){if(h>=n?this.width=h:(t=0,i=0),a>=o?this.height=a:(e=0,s=0),!1!==this.movable&&(t||e)){let i=this.position;i.x=r.left+t,i.y=r.top+e,this.position=i}this.emit("resize",t,e,i,s)}}for(let t in this.resizeRects){let e=this.resizeRects[t];switch(e.index){case 0:e.position.x=-e.width/2,e.position.y=(r.height-e.height)/2;break;case 1:e.position.x=-e.width/2,e.position.y=-e.height/2;break;case 2:e.position.x=(r.width-e.width)/2,e.position.y=-e.height/2;break;case 3:e.position.x=r.width-e.width/2,e.position.y=-e.height/2;break;case 4:e.position.x=r.width-e.width/2,e.position.y=(r.height-e.height)/2;break;case 5:e.position.x=r.width-e.width/2,e.position.y=r.height-e.height/2;break;case 6:e.position.x=(r.width-e.height)/2,e.position.y=r.height-e.height/2;break;case 7:e.position.x=-e.width/2,e.position.y=r.height-e.height/2}}}}export{jmResize};class jmGraph extends jmControl{constructor(t,e,i){if("function"==typeof e&&(i=e,e={}),e=e||{},new.target!==jmGraph)return new Promise(function(s,n){var o=new jmGraph(t,e,i);s&&s(o)});if(super(e,"jmGraph"),this.option=e||{},this.util=this.utils=jmUtils,"undefined"!=typeof wx&&wx.createCanvasContext)this.context=wx.createCanvasContext(t),t=wx.createSelectorQuery().select("#"+t);else{if("string"==typeof t&&"undefined"!=typeof document?t=document.getElementById(t):t.length&&(t=t[0]),"CANVAS"!=t.tagName){let e=document.createElement("canvas");t.appendChild(e),e.width=t.offsetWidth||t.clientWidth,e.height=t.offsetHeight||t.clientHeight,t=e}this.context=t.getContext("2d")}this.canvas=t,this.init(i)}init(t){this.shapes={path:jmPath,arc:jmArc,arraw:jmArraw,bezier:jmBezier,circle:jmCircle,harc:jmHArc,line:jmLine,prismatic:jmPrismatic,rect:jmRect,arrawline:jmArrawLine,image:jmImage,img:jmImage,label:jmLabel,resize:jmResize},this.on("beginDraw",function(){this.context.translate(.5,.5)}),this.on("endDraw",function(){this.context.translate(-.5,-.5)}),this.option.width>0&&(this.width=this.option.width),this.option.height>0&&(this.height=this.option.height),this.eventHandler=new jmEvents(this,this.canvas.canvas||this.canvas),t&&t(this)}get width(){return this.canvas?this.canvas.width:0}set width(t){return this.needUpdate=!0,this.canvas&&(this.canvas.width=t),t}get height(){return this.canvas?this.canvas.height:0}set height(t){return this.needUpdate=!0,this.canvas&&(this.canvas.height=t),t}static create(...t){return new jmGraph(...t)}getPosition(){let t=jmUtils.getElementPosition(this.canvas.canvas||this.canvas);return t.width=this.canvas.width,t.height=this.canvas.height,t.right=t.left+t.width,t.bottom=t.top+t.height,t}registerShape(t,e){this.shapes[t]=e}createShape(t,e){let i=this.shapes[t];if(i){return e||(e={}),e.graph=this,new i(e)}}createShadow(t,e,i,s){return new jmShadow(t,e,i,s)}createLinearGradient(t,e,i,s){return new jmGradient({type:"linear",x1:t,y1:e,x2:i,y2:s})}createRadialGradient(t,e,i,s,n,o){return new jmGradient({type:"radial",x1:t,y1:e,r1:i,x2:s,y2:n,r2:o})}refresh(){this.redraw()}redraw(t,e){this.clear(t||this.width,e||this.height),this.paint()}clear(t,e){t&&e?(this.canvas.width=t,this.canvas.height=e,this.scaleSize&&this.context.scale&&this.context.scale(this.scaleSize.x,this.scaleSize.y)):(t=this.canvas.width,e=this.canvas.height,this.scaleSize&&(t/=this.scaleSize.x,e/=this.scaleSize.y)),this.style&&this.style.fill?this.points=[{x:0,y:0},{x:t,y:0},{x:t,y:e},{x:0,y:e}]:this.context.clearRect&&this.context.clearRect(0,0,t,e)}css(t,e){if(this.canvas)return void 0!==e&&(this.canvas.style[t]=e),this.canvas.style[t]}createPath(t,e){return this.createShape("path",{points:t,style:e})}createLine(t,e,i){return this.createShape("line",{start:t,end:e,style:i})}zoomOut(){this.scale(.9,.9)}zoomIn(){this.scale(1.1,1.1)}zoomActual(){this.scaleSize?this.scale(1/this.scaleSize.x,1/this.scaleSize.y):this.scale(1,1)}scale(t,e){this.normalSize||(this.normalSize={width:this.canvas.width,height:this.canvas.height}),this.context.scale(t,e),this.scaleSize?this.scaleSize={x:t*this.scaleSize.x,y:e*this.scaleSize.y}:this.scaleSize={x:t,y:e},this.refresh()}toDataURL(){return this.canvas.toDataURL?this.canvas.toDataURL():""}autoRefresh(t){var e=this;return function i(){e.needUpdate&&e.redraw(),requestAnimationFrame(i),t&&t()}(),this}}const createJmGraph=(...t)=>new jmGraph(...t);export{jmGraph,createJmGraph as create,jmUtils,jmList,jmProperty,jmShadow,jmGradient,jmEvents,jmControl,jmPath,jmArc,jmArraw,jmBezier,jmCircle,jmHArc,jmLine,jmPrismatic,jmRect,jmArrawLine,jmImage,jmLabel,jmResize};export default jmGraph;